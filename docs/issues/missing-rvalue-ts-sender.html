<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<style>
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
</style>
<title>Missing rvalue reference qualification for task_scheduler::ts-sender::connect()</title>
</head>
<body>
<h3>Missing rvalue reference qualification for <code>task_scheduler::<i>ts-sender</i>::connect()</code></h3>
<p><b>Section:</b> 33.13.5 <a href="https://wg21.link/exec.task.scheduler#8">[exec.task.scheduler] paragraph 8</a></p>
<p><b>Submitter:</b> Dietmar K&uuml;hl</p>
<p><b>Discussion:</b></p>
<p>
The result of <code>schedule(sched)</code> for a scheduler
<code>sched</code> is only required to be movable. An object of
this type may need to be forwarded to an operation state constructor
by <code>task_scheduler::<i>ts-sender</i>::connect</code>. Thus,
this function should be qualified with an rvalue reference.
</p>
<p><b>Proposed resolution:</b></p>
<p>
Add an rvalue qualifier to the declaration of <code>connect</code> in <a href="https://wg21.link/exec.task.scheduler#8">[exec.task.scheduler] paragraph 8</a>:
<blockquote>
<pre>
namespace std::execution {
  class task_scheduler::ts-sender {     // exposition only
  public:
    using sender_concept = sender_t;

    template&lt;receiver Rcvr&gt;
      <i>state&</i>&lt;Rcvr&gt; connect(Rcvr&amp;&amp; rcvr)<ins> &amp;&amp;</ins>;
  };
}
</pre>
</blockquote>
</p>
<p>
In the specification in <a href="https://wg21.link/exec.task.scheduler#10">[exec.task.scheduler] paragraph 10</a> add an rvalue qualifier to <code>connect</code>:
<blockquote>
<pre>
template&lt;receiver Rcvr&gt;
  <i>state</i>&lt;Rcvr&gt; connect(Rcvr&amp;&amp; rcvr)<ins> &amp;&amp;</ins>;
</pre>
<p>-10- <i>Effects</i>: Let <i>r</i> be an object of a type that
models receiver and whose completion handlers result in invoking
the corresponding completion handlers of <code>rcvr</code> or copy thereof.
Returns an object of type <code><i>state</i>&lt;Rcvr&gt;</code> containing an operation state
object initialized with <codoe>connect(<i>SENDER</i>(*this), std::move(<i>r</i>))</codoe>.
</pre>
</blockquote>
</p>
</body>
</html>
