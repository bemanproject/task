<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<style>
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
</style>
<title>task&lt;...&gt;::promise_type supports arbitrary allocator_arg position</title>
</head>
<body>
<h3><code>task&lt;...&gt;::promise_type</code> supports arbitrary <code>allocator_arg</code> position</h3>
<p><b>Section:</b> 33.13.6.5 <a href="https://wg21.link/task.promise">[task.promise]</a></p>
<p><b>Submitter:</b> Dietmar K&uuml;hl</p>
<p><b>Discussion:</b></p>
<p>
Normally the <code>allocator_arg</code> argument has to be the first
argument when present. For <code>task&lt;...&gt;::promise_type</code>
the <code>allocator_arg</code> can appear at an arbitrary position
(except the last because it always needs to be followed by the
allocator). This permission is inconsistent and it position of the
<code>allocator_arg</code> argument and the allocator should be
limited to come first.
</p>
<p>
For containers the optional support for allocators is implemented
once for every container.  For coroutines the optional support for
allocators is implemented once for every coroutine definition. To
support an optional allocator the coroutine definition needs to use
an allocator and either gets duplicated not using an allocator or
a forwarding function is added which adds the default allocator.
With the flexible allocator position optional support can be provided
using a trailing argument list, i.e., adding <code>, auto&&...</code>.
Instead of constraining <code>task</code> it may be more reasonable
to add the flexibility to <code>generator</code>.
</p>
<p><b>Proposed resolution:</b></p>
<p>
TODO-RESOLUTION
</p>
</body>
</html>
