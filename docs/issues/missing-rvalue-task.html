<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<style>
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
</style>
<title>Missing rvalue reference qualification for task::connect()</title>
</head>
<body>
<h3>Missing rvalue reference qualification for task::connect()</h3>
<p><b>Section:</b> 33.13.6.2 <a href="https://wg21.link/task.class">[task.class]</a></p>
<p><b>Submitter:</b> Dietmar K&uuml;hl</p>
<p><b>Discussion:</b></p>
<p>
Coroutines can't be copied. Thus, a <code>task</code> can be
<code>connect()</code> just once.  To represent that
<code>task::connect()</code> should be rvalue reference qualified
but currently it isn't.
</p>
<p><b>Proposed resolution:</b></p>
<p>
In the synopsis in <a href="https://wg21.link/task.class">[task.class]</a> add rvalue
reference qualification to <code>task::connect()</code>:
<blockquote><pre>
namespace std::execution {
  template&lt;class T, class Environment&gt;
  class task {
    ...
    template&lt;receiver Rcvr&gt;
        <i>state</i>&lt;Rcvr&gt; connect(Rcvr&& rcvr) <ins>&amp;&amp;</ins>;
    ...
  }
}
</pre></blockquote>
</p>
<p>
In the specification in <a href="https://wg21.link/task.members">[task.members]</a> paragraph 3 add rvalue
reference qualification to <code>task::connect()</code>:
<blockquote>
<pre>
template&lt;receiver Rcvr&gt;
    <i>state</i>&lt;Rcvr&gt; connect(Rcvr&amp;&amp; rcvr) <ins>&amp;&amp;</ins>;
</pre>
<p>-3- <i>Precondition</i>: <code>bool(handle)</code> is <code>true</code>.</p>
<p>-4- <i>Effects</i>: Equivalent to:</p>
<pre>    return state<Rcvr>(exchange(handle, {}), std::forward<Rcvr>(recv));</pre>
</blockquote>
</p>
</body>
</html>
